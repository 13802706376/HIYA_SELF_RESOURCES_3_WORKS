～～分布式架构精华～～
高性能，高可用，易扩展，可伸缩

1 单机架构
服务器，数据库，文件同一台物理机

2 集群架构
nginx集群，服务器集群，redis集群，文件服务器集群，mysql主从同步，CDN加速

3 分布式架构
垂直拆分，首页，用户，搜索，广告，购物，订单，降低耦合，分而治之，提升体统容错性。

4 服务化架构
子系统共享业务重复建设，资源连接受限，多人维护一个系统，服务两两强耦合，缺少统计监控和治理的手段，缺少熔断机制，所以SOA改造刻不容缓。

服务治理
服务的动态注册和发现，扩容评估，降级处理

dubbo-admin
路由规则，动态配置，服务降级，访问控制，权重调节

分布式跟踪系统
可视化一个完整请求调用链，比如鹰眼，rpcFilter负责拦截请求，traceid，spanid，rpcContext设置到RpcInvacation，后面get。

大流量限流消峰
比如双11，如果不加限制，容易资源耗尽，内存爆，数据库吞吐量降低。
双11手段～扩容，cdn动静分离，缓存，服务降级，限流

常见限流算法
令牌桶～平均速率向桶内放入token，桶容积不变，获取token失败则限流，成功处理。
漏桶～任意速率放入，容积固定，固定速率消费，水漫限流。
nginx实现限流～limit_zone。

消峰
时间分片～抢购时间多少次
答题认证～错开高峰期
消息队列

分表分库带来的问题
acid，连表查询，序列id


traceid的生成
snowflake是一个优秀的分布式Id生成方案。redis单线程inscr